# Guess The Number — Telegram Game + Global Leaderboard (TelebotHost + GitHub Pages)

A simple number-guessing game (Casual 3 digits / Hard 4 digits) that runs as a **Telegram Game** with:
- **Global Top 10** leaderboard (Casual / Hard)
- **Global Rank** shown in the win modal
- **Private DM** after each win with Top 10 + your rank

The game UI is hosted **publicly** on **GitHub Pages**, while scoring + leaderboard logic runs on **TelebotHost** webhooks.

> Because GitHub Pages is public, **do not put any “secret key” inside the HTML**. This project relies on short-lived **session + token** (`s` and `t`) generated by the bot when the game is launched.

---

## Live files

- Game UI: `index.html` (host on GitHub Pages) fileciteturn6file0  
- TelebotHost scripts: see `TELEBOTHOST_COMMANDS.md` (copy/paste into TelebotHost) fileciteturn6file1

---

## How it works

1. A player types `/play` or taps **Play**.
2. Telegram calls the bot’s **`handle_callback_query`** with the game play event.
3. The bot generates:
   - a `sessionId` and a `token`
   - stores them in `Bot.setProperty("sess:<sessionId>")` with a TTL (expiry)
4. The bot opens the GitHub Pages URL with:  
   `https://<your-pages-url>/?s=<sessionId>&t=<token>`
5. On win, the HTML calls TelebotHost webhook:
   - `score_submit` with `s`, `t`, `score`, `mode`
6. `score_submit`:
   - validates session + token + expiry
   - stores **Top N runs** (duplicates allowed) in:
     - `global_lb_casual_v1` or `global_lb_hard_v1`
   - DMs the player Top 10 + their rank
7. The HTML calls `rank_get` to fetch the rank and display it in the win modal.

---

## Setup overview (5 steps)

### 1) Fork / copy this repo
Put `index.html` in your repository root (or adjust paths accordingly).

### 2) Enable GitHub Pages
GitHub → Repo → **Settings** → **Pages** → deploy from your branch.  
Your game URL will look like:  
`https://<username>.github.io/<repo>/`

### 3) Create a Telegram Game + Bot
- Create bot via **@BotFather**
- Create a **Game** via BotFather (`/newgame`)
- Note your **Game short name** (example in code: `guessdanumber_bot`)

### 4) Create a TelebotHost bot
- Create a bot in TelebotHost and connect it to your Telegram bot token
- In TelebotHost, create/paste the scripts listed in `TELEBOTHOST_COMMANDS.md`

### 5) Update constants in both places

#### In TelebotHost: `handle_callback_query`
Update:
- `GAME_SHORT_NAME` → your Telegram game short name
- `GAME_URL` → your GitHub Pages URL

#### In `index.html`
Update:
- `TELEGRAM_SCORE_ENDPOINT` → webhook URL for `score_submit`
- `TELEGRAM_RANK_ENDPOINT` → webhook URL for `rank_get`

**How to get webhook URLs quickly**
Create two helper commands in TelebotHost (optional):
- `/show_submit_url` → prints `Webhook.getGlobalUrl("score_submit", ...)`
- `/show_rank_url` → prints `Webhook.getGlobalUrl("rank_get", ...)`

Then copy the printed URLs into `index.html`.

---

## TelebotHost command naming rules (important)

- **Chat commands** you type in Telegram **start with `/`**  
  Example: `/start`, `/help`, `/globaltop`

- **Webhook commands** called by your HTML **do NOT have `/`**  
  Example: `score_submit`, `rank_get`

- Telegram update handlers in TelebotHost are typically named exactly:
  - `handle_callback_query`
  - `handle_inline_query`

---

## Security notes (public GitHub Pages)

- Anything in `index.html` is public. Don’t embed secrets.
- The webhook URLs include a `sig` value; that’s expected and OK to be public.
- Protection comes from:
  - session+token validation
  - short TTL (default 15 minutes)
  - score sanity limits

---

## Troubleshooting

### “Global Top shows no scores yet”
Check:
- Your webhook command is named **exactly** `score_submit` (lowercase, no `/`)
- Your HTML is calling `score_submit` with:
  - `&s=...&t=...&score=...&mode=casual|hard`
- Your `handle_callback_query` opens the game URL with `?s=...&t=...`

### “Rank shows —”
- Ensure `rank_get` returns JSON (`{ ok:true, rank: ... }`)
- Ensure HTML calls `rank_get` with `&mode=casual|hard`

---

## License
Use freely for family/kids challenges. If you share publicly, a credit link back is appreciated.
